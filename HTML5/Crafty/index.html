<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Crafty.js workshop</title>
	<meta name="viewport" content="width=1024">

        <link rel="stylesheet" href="dist/coderdeck-core.min.css" type="text/css">
	<link rel="stylesheet" id='style-theme-link' href="dist/coderdeck.css" type="text/css" >

	<script src='dist/jquery.min.js'></script>
	<script src="dist/modernizr.js"></script>
</head>
<body class="deck-container">

<script type='text/coderdeck' id='coderdeck-default'>
  <html>
    <head>
      <script src='dist/jquery.min.js'>SCRIPTEND
      <script src='js/crafty.js'>SCRIPTEND
    </head>
    <body>
    <script>
	    CODE
    SCRIPTEND
    </body>
</html>
</script>



<script type='text/coderdeck' id='crafty-template'>
  <html>
    <head>
      <script src='dist/jquery.min.js'>SCRIPTEND
      <script src='js/crafty.js'>SCRIPTEND
    </head>
    <body>
    <script>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();
  Crafty.background("black");

  CODE
});
    SCRIPTEND
    </body>
</html>
</script>



<article class='slide slide-subhead'>
<h1>Crafty.js </h1>
<h2><a href='http://bit.ly/crafty-workshop'>http://bit.ly/crafty-workshop</a><br/>
       
        use the arrow-keys go between slides.<br/><br/>
      <a href='http://craftyjs.com/'>http://craftyjs.com/</a><br/><br/>
      <a href='http://cykod.com/blog'>Pascal Rettig</a> / <a href='http://twitter.com/cykod'>@cykod</a>
        </h2>
</article>

<article class='slide slide-subhead'>
<h1>Why Crafty?</h1>
</article>



<article class='slide slide-list'>
<h2>A Good Engine for the Web</h2>
<ul>
<li class="slide">
	<h3>Small: 15k compressed and gzip'd</h3>
</li>
<li class="slide">
	<h3>Simple: 1 file to include</h3>
</li>
<li class="slide">
	<h3>DOM or Canvas Rendering</h3>
</li>
<li class="slide">
	<h3>Open-source: MIT or GPL (Take it and do what you will)</h3>
</li>
</ul>
</article>



<article class='slide slide-list'>
<h2>A Good Engine for Javascript</h2>
<ul>
<li class="slide">
	<h3>No classical inheritance model (Protoypes! Javscript is made of Prototypes!)</h3>
</li>
<li class="slide">
	<h3><a href='http://cowboyprogramming.com/2007/01/05/evolve-your-heirachy/'>Entity-component system</a> instead</h3>
</li>
<li class="slide">
	<h3>Entities (sprites) built up out of reusable components.</h3>
</li>
<li class="slide">
	<h3>jQuery style selector mechanism for working with entities</h3>
</li>
<li class="slide">
	<h3>Good Event support to reduced coupling</h3>
</li>
</ul>
</article>


<article class='slide slide-list'>
<h2>A Good box of Tools</h2>
<ul>
	<li class="slide">
		<h3>Asset Loading</h3>
	</li>
	<li class="slide">
		<h3>Sprite Map support</h3>
	</li>
	<li class="slide">
		<h3>Audio Support</h3>
	</li>
	<li class="slide">
		<h3>Isometric support</h3>
	</li>
	<li class="slide">
		<h3>SAT collision detection</h3>
	</li>
</ul>
</article>

<article class='slide slide-subhead'>
<h1>Why Not Crafty?</h1>
</article>




<article class='slide slide-list'>
<h2>Still a relatively new engine</h2>
<ul>
	<li class="slide">
		<h3>Not tuned for things like platformers</h3>
	</li>
	<li class="slide">
		<h3>Interfaces have still been changing</h3>
	</li>
	<li class="slide">
		<h3>Documentation, tutorials not great, up-to-date</h3>
	</li>
</ul>
</article>



<article class='slide slide-list'>
<h2>Using Crafty</h2>
<p>Just include the crafty.js file, and then your game code, whatever that is</p>
<pre class='prettyprint'>
&lt;!DOCTYPE html&gt; 
&lt;html&gt; 
    &lt;head&gt; 
        &lt;title&gt;My Awesome Game&lt;/title&gt;
        &lt;script src="crafty.js" type="text/javascript"&gt;&lt;/script&gt; 
        &lt;script src="game.js" type="text/javascript"&gt;&lt;/script&gt; 
    &lt;/head&gt; 
    &lt;body&gt; 
    &lt;/body&gt; 
&lt;/html&gt;
</pre>
</article>

<article class='slide slide-list'>
<h2>Bootstrapping Crafty</h2>
<pre class='prettyprint'>
// When the DOM has loaded
$(document).ready(function() {

  // Initialize Crafty
  Crafty.init(640, // 640 Pixels Wide
              480  // 480 Pixels Tall
              );

  Crafty.canvas.init(); // Create a Canvas Element 

});
</pre>
</article>

<article class='slide slide-list'>
<h2>Add Some Entities + Components</h2>
<pre class='prettyprint'>
// Create a player entity
var player = Crafty.e(); 

// Add some components to the entity
player.addComponent("2D, Canvas, Color"); 

// Set some attribute values 
// (Available methods dependant on components added)
player.color("red").attr({ w:50, h:50 });
</pre>
</article>

<article class='slide slide-list'>
<h2>Putting it all together</h2>
<p>Let's Bootstrap crafty and start our Game</p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480);
  Crafty.canvas.init();

  var player = Crafty.e(); 
  player.addComponent("2D, Canvas, Color")

  player.color("red").attr({w:50, h:50});
});
</textarea>
</article>





<article class='slide slide-list'>
<h2>Chaining with Crafty</h2>
<p>Most of crafty elements support chaining (aka jQuery style)</p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();

  var player = Crafty.e("2D, Canvas, Color")
          .color("red")
          .attr({w:50, h:50});
});
</textarea>
</article>


<article class='slide slide-list'>
<h2>Selection</h2>
<p>Calling Crafty as a function will do component-based selection (However, <code>Crafty("Color").color("red");</code> won't work, primarily for performance reasons (<a href='https://github.com/louisstow/Crafty/issues/91'>Issue 91</a>, we need to use each instead)</p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();

  var box1 = Crafty.e("2D, Canvas, Color").attr({w:50, h:50}).color("red");
  var box2 = Crafty.e("2D, Canvas, Color").attr({w:50, h:50, x:100}).color("blue");

  //Crafty("Color").each(function() { this.color("pink"); });

});
</textarea>
</article>

<article class='slide slide-list'>
<h2>Controls</h2>
<p>We can add a simple four-way controls component (You'll need to click in the iframe)</p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();
  Crafty.background("black");

  var player = Crafty.e("2D, Canvas, Color")
          .color("red")
          .attr({w:50, h:50});


  // Can use the arrow keys as well,
  // but we don't want to accidentally change slides
  player.addComponent("Fourway").fourway(5)
});
</textarea>
</article>

<article class='slide slide-list'>
<h2>2 Player Controls</h2>
<p>Why stick with 1 player? Let's add another, speedier player, use custom Multiway keys</p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();
  Crafty.background("black");

  var player1 = Crafty.e("2D, Canvas, Color")
          .color("red")
          .attr({w:50, h:50});


  var player2 = Crafty.e("2D, Canvas, Color")
          .color("green")
          .attr({w:50, h:50, x: 50, y:50});


  player1.addComponent("Multiway").multiway(3,{ 
          W: -90, S: 90, D: 0, A: 180});

  player2.addComponent("Multiway").multiway(10,{ 
          UP_ARROW: -90, DOWN_ARROW: 90, 
          RIGHT_ARROW: 0, LEFT_ARROW: 180});
});
</textarea>
</article>


<article class='slide slide-list'>
<h2>Simple Collision Detection</h2>
<p>Let's prevent our players from running over each other. <a href='http://craftyjs.com/api/Collision.html'>Docs</a></p>
<textarea class='coder-editor'  data-language='javascript'>
$(document).ready(function() {

  Crafty.init(640,480).canvas.init();
  Crafty.background("black");

  var player1 = Crafty.e("2D, Canvas, Color")
          .color("red")
          .attr({w:50, h:50});


  var player2 = Crafty.e("2D, Canvas, Color")
          .color("green")
          .attr({w:50, h:50, x: 50, y:50});

  /* Collision Code */
  player1.addComponent("Collision").bind('Moved', function(from) {
    if(this.hit('2D')) {
       this.attr({x: from.x, y:from.y});
    }
  });
  player2.addComponent("Collision").bind('Moved', function(from) {
    if(this.hit('2D')) {
       this.attr({x: from.x, y:from.y});
    }
  });



  player1.addComponent("Multiway").multiway(3,{ 
          W: -90, S: 90, D: 0, A: 180});

  player2.addComponent("Multiway").multiway(10,{ 
          UP_ARROW: -90, DOWN_ARROW: 90, 
          RIGHT_ARROW: 0, LEFT_ARROW: 180});
});
</textarea>
</article>

<article class='slide slide-list'>
<h2>Gravity</h2>
<p>Let's add in the Gravity component. Note: code below s going to skip the initial stuff to save space.</p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>
  var player1 = Crafty.e("2D, Canvas, Color")
       .color("white")
       .attr({w:50, h:50, x:150});

  player1.addComponent('Gravity').gravity();
</textarea>
</article>


<article class='slide slide-list'>
<h2>Adding in a floor</h2>
<p>Let's add in a floor</p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>

  var player = Crafty.e("2D, Canvas, Color, Player, Physics")
       .color("white")
       .attr({w:50, h:50, x:126, y:0});

  player.addComponent('Gravity').gravity("Floor");
  player.addComponent("Twoway").twoway(5,50)
  player.addComponent("Collision");


  var floor = Crafty.e("2D, Canvas, Color, Collision, Floor")
		.color("blue")
 	        .attr({h:30, w:400, x:0, y:380 })
</textarea>
</article>


<article class='slide slide-list'>
<h2>platformer collisions :(</h2>
<p>Built in controls / collisions aren't good for platformers</p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>

  var player = Crafty.e("2D, Canvas, Color, Player")
       .color("white")
       .attr({w:50, h:50, x:126, y:0});

  player.addComponent('Gravity').gravity("Floor");
  player.addComponent("Twoway").twoway(5)
  player.addComponent("Collision").collision();


  var floor = Crafty.e("2D, Canvas, Color, Collision, Floor")
		.color("blue")
		.attr({h:30, w:400, x:0, y:380 })
		.collision()

  var block = Crafty.e("2D, Canvas, Color, Collision, Block")
		.color("red")
		.attr({h:30, w:400, x:50, y:200 })
		.collision()

  player.onHit("Block",function(hit) {
    this._falling = false;
    this.attr({x: this._x + hit[0].normal.y * hit[0].overlap * 1.1, 
               y: this._y + hit[0].normal.x * hit[0].overlap * 1.1});
  });


</textarea>
</article>

<article class='slide slide-list'>
<h2>Let's do a nethack clone instead</h2>
<p>Asset Loading <a href='images/dungeon.png'>Dungeon</a> <a href='images/monsters.png'>Monsters</a></p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>
  Crafty.load(["images/dungeon.png",
               "images/monsters.png"], function() {
     alert("Yay loaded!");
  });
</textarea>
</article>


<article class='slide slide-list'>
<h2>Scenes..</h2>
<p>Calling scene will destroy all entities on the page</a></p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>

  //the loading screen that will display while our assets load
  Crafty.scene("loading", function() {
    //load takes an array of assets and a callback when complete
    Crafty.load(["images/dungeon.png","images/monsters.png"], function() {
      setTimeout(function() { 
         Crafty.scene("main"); //when everything is loaded, run the main scene
      }, 2000);
    });

    //black background with some loading text
    Crafty.background("#FFF");
    Crafty.e("2D, DOM, Text").attr({w: 640, h: 20, x: 0, y: 120})
    .text("Loading")
    .css({"text-align": "center"});
  });
 
  Crafty.scene("main",function() {
    alert("Main scene...");
  });

  Crafty.scene("loading");
</textarea>
</article>

<article class='slide slide-list'>
<h2>Sprites</h2>
<p>Crafty.sprite creates an entity <a href='images/dungeon.png'>Dungeon</a> <a href='images/monsters.png'>Monsters</a></p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>

  Crafty.sprite(32,"images/dungeon.png", {
     floor: [0,0],
     wall1: [2,1],
     stairs: [1,3]
  });

  Crafty.sprite(32,"images/monsters.png", {
     hero1: [14,1],
     blob1: [6,0]
  });

  //the loading screen that will display while our assets load
  Crafty.scene("loading", function() {
    Crafty.load(["images/dungeon.png","images/monsters.png"], function() {
         Crafty.scene("main"); //when everything is loaded, run the main scene
    });
  });
 
  Crafty.scene("main",function() {
    Crafty.background("#FFF");
    var player = Crafty.e("2D, Canvas, hero1")
         .attr({x:0, y:0});

    var blob = Crafty.e("2D, Canvas, blob1")
         .attr({x:50, y:50});
  });

  Crafty.scene("loading");
</textarea>
</article>

<article class='slide slide-list'>
<h2>Binding Controls</h2>
<p>Crafty.sprite creates an entity <a href='images/dungeon.png'>Dungeon</a> <a href='images/monsters.png'>Monsters</a></p>
<textarea class='coder-editor' data-coder-template='crafty-template'  data-language='javascript'>

Crafty.c("PlayerControls", {
    _keys: { 
    UP_ARROW: [0,-1],
    DOWN_ARROW: [0,1],
    RIGHT_ARROW: [1,0],
    LEFT_ARROW: [-1,0]
    }, 
    init: function() {
      this._moveX = 0;
      this._moveY = 0;

      for(var k in this._keys) {
        var keyCode = Crafty.keys[k] || k;
        this._keys[keyCode] = this._keys[k];
      }


      this.bind("KeyDown",function(e) {
        if(this._keys[e.key]) {
          this._moveX = this._keys[e.key][0];
          this._moveY = this._keys[e.key][1];
        }
      }).bind("EnterFrame",function() {
        if(this._moveX || this._moveY) {
           this.x += this._moveX * 32;
           this.y += this._moveY * 32;
           this.trigger('Moved', {x: this.x, y: this.y});
           this._moveX = 0;
           this._moveY = 0;
        }
      });
    }
    
  });

  Crafty.sprite(32,"images/dungeon.png", {
     floor: [0,0],
     wall1: [2,1],
     stairs: [1,3]
  });

  Crafty.sprite(32,"images/monsters.png", {
     hero1: [14,1],
     blob1: [6,0]
  });

  //the loading screen that will display while our assets load
  Crafty.scene("loading", function() {
    Crafty.load(["images/dungeon.png","images/monsters.png"], function() {
         Crafty.scene("main"); //when everything is loaded, run the main scene
    });
  });
 
  Crafty.scene("main",function() {
    Crafty.background("#FFF");
    var player = Crafty.e("2D, Canvas, PlayerControls, hero1")
         .attr({x:0, y:0});

    var blob = Crafty.e("2D, Canvas, blob1")
         .attr({x:50, y:50});
  });

  Crafty.scene("loading");
</textarea>
</article>


<article class='slide slide-list'>
<h2>To Do: download http://bit.ly/craftyzip</h2>
<ul>
	<li>
		<h3>Add a background map</h3>
	</li>
	<li>
		<h3>Add collisions with enemies</h3>
	</li>
	<li>
		<h3>Add an inventory</h3>
	</li>
	<li>
		<h3>Add multiple scenes / levels</h3>
	</li>
</ul>
</article>




<script src='dist/coderdeck.min.js'></script>

<script>
	$(function() {
		$.deck('.slide');
	});
</script>
</body>
</html>
